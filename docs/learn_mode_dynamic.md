## –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è

> [‚Üê –ù–∞–∑–∞–¥ –∫ –æ–≥–ª–∞–≤–ª–µ–Ω–∏—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏](README.md) ¬∑
> [–ë–∞–∑–æ–≤—ã–π —Ä–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è](learn_mode.md)

–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π: –æ–Ω –ø–æ–¥–±–∏—Ä–∞–µ—Ç —à–∞–≥–∏ —É—Ä–æ–∫–∞ —Å –ø–æ–º–æ—â—å—é LLM –∏
–∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–∂–∏–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫
—Ä–µ–∑–µ—Ä–≤, –µ—Å–ª–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.

## –í–∫–ª—é—á–µ–Ω–∏–µ

–í —Ñ–∞–π–ª–µ `.env` —É–∫–∞–∂–∏—Ç–µ, —á—Ç–æ —Ä–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è –≤–∫–ª—é—á—ë–Ω, –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫
–∫–æ–Ω—Ç–µ–Ω—Ç–∞:

```bash
LEARNING_MODE_ENABLED=true
LEARNING_CONTENT_MODE=dynamic  # –∏–ª–∏ static
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∞–∫—Ç–∏–≤–µ–Ω `dynamic`. –ó–Ω–∞—á–µ–Ω–∏–µ `static` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –±–∞–∑—ã
(`make load-lessons`); –µ—Å–ª–∏ –±–∞–∑–∞ –ø—É—Å—Ç–∞, –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∫
–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–º—É —Ç—å—é—Ç–æ—Ä—É.

## –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø—Ä–æ—Ñ–∏–ª—è

1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç_AI¬ª –∏–ª–∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/learn`.
2. –ë–æ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –∑–∞–¥–∞—Å—Ç –≤–æ–ø—Ä–æ—Å—ã:
   - ¬´–£–∫–∞–∂–∏—Ç–µ –≤–∞—à—É –≤–æ–∑—Ä–∞—Å—Ç–Ω—É—é –≥—Ä—É–ø–ø—É.¬ª
   - ¬´–£–∫–∞–∂–∏—Ç–µ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π.¬ª
   –¢–∏–ø –¥–∏–∞–±–µ—Ç–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è –∏ –º–µ–Ω—è—Ç—å –µ–≥–æ –Ω–µ–ª—å–∑—è.
3. –í–æ–∑—Ä–∞—Å—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞ –∏ —É—Ä–æ–≤–µ–Ω—å –∑–Ω–∞–Ω–∏–π —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `learning_user_profile` ‚Äî —ç—Ç–æ –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è `/learning-profile`. –ü—Ä–∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –æ–±—Ä–∞—â–µ–Ω–∏—è—Ö –±–æ—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ `_hydrate`, –ø–æ—ç—Ç–æ–º—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –æ–ø—Ä–æ—Å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.
   –ü–æ–ª–µ `diabetes_type` —á–∏—Ç–∞–µ—Ç—Å—è –∏–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ `/profile/self` –∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —á–µ—Ä–µ–∑ —á–∞—Ç –∏–ª–∏ API.
   –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–¥–∏–Ω —Ä–∞–∑, –∑–∞—Ç–µ–º –±–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–ª–∞–Ω —É—Ä–æ–∫–∞ –∏ –ø–µ—Ä–≤—ã–π —à–∞–≥.
4. –ü–ª–∞–Ω —É—Ä–æ–∫–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—ã `learning_plans` –∏ `learning_progress`. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–Ω–∏–º–∞—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —á–µ—Ä–µ–∑ `_hydrate`.
5. –î–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/reset`.

## –ö–æ–º–∞–Ω–¥—ã

- `/learn` ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω –∏ —Å—Ä–∞–∑—É –Ω–∞—á–∞—Ç—å –ø–µ—Ä–≤—ã–π —à–∞–≥.
- `/plan` ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å –ø–ª–∞–Ω —É—Ä–æ–∫–∞.
- `/skip` ‚Äî –ø–µ—Ä–µ–π—Ç–∏ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É.
- `/reset` ‚Äî —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ –∑–∞–Ω–æ–≤–æ –ø—Ä–æ–π—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã –ø—Ä–æ—Ñ–∏–ª—è.

## –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç—å –¥–∏–∞–ª–æ–≥–∞

–ü—Ä–∏ –≤—ã–¥–∞—á–µ –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ —à–∞–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç `awaiting=True`.
–ë–æ—Ç –æ–∂–∏–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç –∏ –ª—é–±–æ–µ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ —Ä–µ–∞–∫—Ü–∏—é –Ω–∞
—Ç–µ–∫—É—â–∏–π —É—Ä–æ–∫. –ü–æ–∫–∞ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å –∏ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥, —Ñ–ª–∞–≥ –≤—Ä–µ–º–µ–Ω–Ω–æ
—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –≤ `False`. –ß—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `STEP_GRACE_PERIOD` ‚Äî –ø—è—Ç—å –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —à–∞–≥–∞. –ï—Å–ª–∏
—Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –≤ —ç—Ç–æ—Ç –∏–Ω—Ç–µ—Ä–≤–∞–ª, –æ–Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ —Å—á–∏—Ç–∞–µ—Ç—Å—è –æ—Ç–≤–µ—Ç–æ–º. –ü–æ
–∏—Å—Ç–µ—á–µ–Ω–∏–∏ –ø–µ—Ä–∏–æ–¥–∞ –¥–∏–∞–ª–æ–≥ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–º –∏ –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
–∫–∞–∫ –æ–±—ã—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã. –¢–∞–∫–∞—è –ª–æ–≥–∏–∫–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–ª–∞–≤–Ω–æ–µ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —É—Ä–æ–∫–∞ –±–µ–∑
–ø–æ—Ç–µ—Ä–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

## –ö–Ω–æ–ø–∫–∞ ¬´ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç_AI¬ª

–í –æ—Å–Ω–æ–≤–Ω–æ–º –º–µ–Ω—é –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞:

```
[ü§ñ –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç_AI]
```

–≠—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç –∫–æ–º–∞–Ω–¥—ã `/learn`. –ö–Ω–æ–ø–∫–∞ –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞.

## –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

1. –í `.env` –≤–∫–ª—é—á–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `LEARNING_MODE_ENABLED=true` –∏ –ø—Ä–∏
   –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ `LEARNING_CONTENT_MODE=static`.
2. –î–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Ä–æ–∫–∏:
   `make migrate && make load-lessons`.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `python services/api/app/bot.py`.

### –°—Ü–µ–Ω–∞—Ä–∏–π –ø—Ä–æ–≤–µ—Ä–∫–∏

| –ö–æ–º–∞–Ω–¥–∞             | –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç                                            |
|---------------------|------------------------------------------------------------|
| `/learn`            | –í–æ–ø—Ä–æ—Å—ã –ø—Ä–æ—Ñ–∏–ª—è (–µ—Å–ª–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –µ—â—ë –Ω–µ –ø—Ä–æ–π–¥–µ–Ω)            |
| `/learn` –ø–æ—Å–ª–µ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ | –ü–ª–∞–Ω —É—Ä–æ–∫–∞ –∏ –ø–µ—Ä–≤—ã–π —à–∞–≥                             |
| `/plan`             | –ü–ª–∞–Ω —É—Ä–æ–∫–∞                                                 |
| `/skip`             | –ü—Ä–æ–ø—É—Å–∫ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞                                     |
| `/reset`            | –°–±—Ä–æ—Å –ø—Ä–æ–≥—Ä–µ—Å—Å–∞                                           |

–î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏:

```bash
python scripts/probe_learn.py --user 123 --lesson xe_basics
```

### PTB‚Äë—Ç–µ—Å—Ç—ã

–ú–∏–Ω–∏‚Äë—Å–∞–º–æ—Ç–µ—Å—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

```bash
python scripts/ptb_selftest.py
```

–Æ–Ω–∏—Ç‚Äë—Ç–µ—Å—Ç—ã –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –∫–æ–º–∞–Ω–¥:

```bash
pytest tests/learning/test_handlers_e2e.py
```

–°–∫—Ä–∏–ø—Ç –∏–ª–∏ —Ç–µ—Å—Ç—ã –≤—ã–≤–æ–¥—è—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫.

