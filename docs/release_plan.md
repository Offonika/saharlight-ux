# План релиза

Документ описывает последовательность этапов вывода обновления и критерии перехода между ними. При изменениях документ согласуется с командой и актуализируется.

## Этап 1. Миграции и репозитории
- применяем миграции БД и обновляем репозитории.
- **Критерии перехода:**
  - все миграции применены на staging, дампы успешны;
  - репозитории синхронизированы, нет конфликтов.
- **Критерии отката:**
  - ошибки в миграциях или расхождения схем;
  - невозможность поднять сервис на чистой БД.
- **Rollback:** откат на предыдущую миграцию, восстановление из резервной копии.

## Этап 2. Гидратация и память
- прогоняем гидратацию кешей и проверяем потребление памяти.
- **Критерии перехода:**
  - кеши заполняются корректно, потребление памяти в допустимых пределах;
  - мониторинг не показывает утечек.
- **Критерии отката:**
  - сбой гидратации или превышение лимитов памяти.
- **Rollback:** очистка кешей, возврат прежних конфигураций, перезапуск сервиса.

## Этап 3. Fail‑open логи
- настраиваем fail‑open логирование для устойчивости.
- **Критерии перехода:**
  - при отказе внешних систем логи продолжают писаться локально;
  - алерты по логам не фиксируют ошибок записи.
- **Критерии отката:**
  - потеря логов или рост латентности из-за логирования.
- **Rollback:** отключение fail‑open и возврат к прежнему sink.

## Этап 4. Метрики/алёрты и e2e
- включаем метрики, алёрты и прогоняем end-to-end тесты.
- **Критерии завершения:**
  - метрики отображаются в дашбордах;
  - алёрты срабатывают на тестовых триггерах;
  - e2e прогон проходит без регрессий.
- **Критерии отката:**
  - отсутствие критических метрик или ложные алёрты;
  - провал e2e прогона.
- **Rollback:** отключение новых метрик и алёртов, возврат предыдущих настроек.

## Переходы и актуализация
Переход к следующему этапу выполняется после подтверждения критериев текущего. При возникновении критериев отката происходит возврат к предыдущей стабильной версии и фиксация причин. Документ обновляется по итогам обсуждения с командой.
