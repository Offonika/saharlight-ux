# Отчётность: визуализация раздельных доз инсулина

Документ описывает правила отображения дневника и аналитики после разделения полей `insulin_short` и `insulin_long`.

## Форматы карточек
- **Суточная карточка**: перечислите два значения раздельно — «Короткий: 6 ед.» и «Длинный: 10 ед.». Если значение отсутствует,
  выводите «—».
- **График болюсного инсулина**: линия по `insulin_short`; точки без данных пропускаем.
- **График базального инсулина**: отдельная линия по `insulin_long`.

## Правила агрегации
- Не суммируйте `insulin_short` и `insulin_long` в одном показателе — пользователю важна раздельная динамика.
- Суточные/недельные суммы допускаются только по каждому полю отдельно.
- Записи, пришедшие с `dose`, отображаются как «Короткий (легаси): X ед.» до тех пор, пока пользователь не обновит клиент.

## Сценарий с legacy-полем
1. Если в записи заполнено `dose`, а новые поля пусты — показываем только короткий инсулин с пометкой «легаси». Длинный оставляем как «не указано».
2. При смешанных значениях (`dose` и `insulin_short`) используем `insulin_short`, а `dose` показываем в подсказке «поле будет удалено».
3. Исторические выгрузки сохраняют `dose` как запасной столбец, но не отображают его на основных графиках.

## Проверки и эскалации
- Дизайн‑система должна содержать обновлённые токены/лейблы (см. [копирайтинг](../content/style/insulin-doses-copy.md)).
- Если BI обнаруживает расхождения между коротким и длинным графиком, проверяйте пайплайн ETL на корректную фильтрацию NULL.
- Все правки отчётности согласовываются с владельцем ADR [005](../ADR/005-split-insulin-doses.md).
