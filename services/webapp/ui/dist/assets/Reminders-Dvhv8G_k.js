import{c as w,a as M,u as z,j as e,b as y}from"./index-gZWaLxZh.js";import{u as B,r as p}from"./vendor-CzhASIQC.js";import{M as P}from"./MedicalHeader-BiVwHQVw.js";import{g as H,u as I,d as D}from"./reminders-DdSXuqmQ.js";import{M as u}from"./MedicalButton-CxU4I3xT.js";import{C as k}from"./clock-BjnWLbLS.js";import{P as L,T as S}from"./trash-2-GlWKEENO.js";import"./switch-CGngOfw1.js";import"./DefaultApi-BASYk00C.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=w("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=w("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),E={sugar:"Измерение сахара",insulin:"Инсулин",meal:"Приём пищи",medicine:"Лекарства"},A={sugar:"🩸",insulin:"💉",meal:"🍽️",medicine:"💊"},R=t=>t==="meds"?"medicine":t;function b(t){const[l,a]=t.split(":").map(Number);return(l||0)*60+(a||0)}function q(){return e.jsxs("div",{className:"rem-card animate-pulse",children:[e.jsx("div",{className:"rem-left"}),e.jsxs("div",{className:"rem-main",children:[e.jsx("div",{className:"h-5 w-40 rounded bg-muted/30"}),e.jsxs("div",{className:"rem-meta mt-1",children:[e.jsx("span",{className:"h-6 w-16 rounded-full bg-muted/30"}),e.jsx("span",{className:"h-6 w-28 rounded-full bg-muted/30"})]})]}),e.jsxs("div",{className:"rem-actions",children:[e.jsx("div",{className:"icon-btn"}),e.jsx("div",{className:"icon-btn"}),e.jsx("div",{className:"icon-btn"})]})]})}function Y({reminder:t,index:l,onToggle:a,onEdit:v,onDelete:h}){const d=R(t.type),o=A[d],f=E[d];return e.jsxs("div",{className:y("rem-card",!t.active&&"opacity-60"),style:{animationDelay:`${l*80}ms`},children:[e.jsx("div",{className:"rem-left","aria-hidden":!0,children:o}),e.jsxs("div",{className:"rem-main",children:[e.jsx("div",{className:"rem-title font-medium text-foreground",children:t.title}),e.jsxs("div",{className:"rem-meta",children:[e.jsxs("span",{className:"badge",children:[e.jsx(k,{className:"inline -mt-0.5 mr-1 h-3 w-3"}),t.time]}),e.jsx("span",{className:"badge badge-tonal",children:f})]})]}),e.jsxs("div",{className:"rem-actions",children:[e.jsx(u,{size:"icon",variant:"ghost",className:y(t.active?"bg-success/10 text-success":"bg-secondary text-muted-foreground"),onClick:()=>a(t.id),"aria-label":t.active?"Отключить напоминание":"Включить напоминание",children:e.jsx(_,{className:"w-4 h-4"})}),e.jsx(u,{size:"icon",variant:"ghost",onClick:()=>v(t),"aria-label":"Редактировать",children:e.jsx(L,{className:"w-4 h-4"})}),e.jsx(u,{size:"icon",variant:"destructive",onClick:()=>h(t.id),"aria-label":"Удалить",children:e.jsx(S,{className:"w-4 h-4"})})]})]})}function X(){const t=B(),{toast:l}=M(),{user:a,sendData:v,isReady:h}=z(),[d,o]=p.useState([]),[f,g]=p.useState(!0),[N,j]=p.useState(null);p.useEffect(()=>{if(!h)return;if(!(a!=null&&a.id)){g(!1),j(e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-destructive",children:"Не удалось получить данные пользователя."}),e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(u,{onClick:()=>window.location.reload(),children:"Повторить"}),e.jsx(u,{asChild:!0,variant:"outline",children:e.jsx("a",{href:"https://t.me/undefined?startapp=reminders",target:"_blank",rel:"noopener noreferrer",children:"Открыть в Telegram"})})]})]}));return}g(!0),j(null);let i=!1;return(async()=>{try{const c=await H(a.id);if(i)return;const s=(c||[]).map(n=>{const r=R(n.type);return{id:n.id??0,type:r,title:n.title??E[r],time:n.time||"",active:n.isEnabled??!1,interval:n.intervalHours!=null?n.intervalHours*60:void 0}});s.sort((n,r)=>b(n.time)-b(r.time)),o(s)}catch(c){if(!i){const s=c instanceof Error?c.message:"Не удалось загрузить напоминания";j(e.jsx("p",{className:"text-destructive mb-4",children:s})),l({title:"Ошибка",description:s,variant:"destructive"})}}finally{i||g(!1)}})(),()=>{i=!0}},[l,a==null?void 0:a.id,h]);const T=async i=>{if(!(a!=null&&a.id))return;const c=[...d],s=c.find(r=>r.id===i);if(!s)return;const n=!s.active;o(r=>r.map(m=>m.id===i?{...m,active:n}:m));try{await I({telegramId:a.id,id:i,type:s.type,time:s.time,intervalHours:s.interval!=null?s.interval/60:void 0,isEnabled:n});const r=s.interval!=null?s.interval/60:void 0,m=r!=null&&Number.isInteger(r)?`${r}h`:s.time;v({id:i,type:s.type,value:m}),l({title:"Напоминание обновлено",description:"Статус напоминания изменён"})}catch(r){o(c);const m=r instanceof Error?r.message:"Не удалось обновить напоминание";l({title:"Ошибка",description:m,variant:"destructive"})}},C=async i=>{if(!(a!=null&&a.id))return;const c=[...d];o(s=>s.filter(n=>n.id!==i));try{await D(a.id,i),l({title:"Напоминание удалено",description:"Напоминание успешно удалено"})}catch(s){o(c);const n=s instanceof Error?s.message:"Не удалось удалить напоминание";l({title:"Ошибка",description:n,variant:"destructive"})}};let x;return f?x=e.jsx("div",{className:"space-y-3 mb-6",children:Array.from({length:4}).map((i,c)=>e.jsx(q,{},c))}):N?x=e.jsx("div",{className:"text-center py-12",children:N}):d.length===0?x=e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Нет напоминаний"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Добавьте первое напоминание для контроля диабета"}),e.jsx(u,{onClick:()=>t("/reminders/new"),size:"lg",children:"Создать напоминание"})]}):x=e.jsx("div",{className:"space-y-3 mb-6",children:d.map((i,c)=>e.jsx(Y,{reminder:i,index:c,onToggle:T,onEdit:s=>t(`/reminders/${s.id}/edit`,{state:s}),onDelete:C},i.id))}),e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(P,{title:"Напоминания",showBack:!0,onBack:()=>t("/"),children:e.jsx(u,{size:"icon",onClick:()=>t("/reminders/new"),className:"bg-primary text-primary-foreground hover:bg-primary/90 border-0","aria-label":"Добавить напоминание",children:e.jsx($,{className:"w-5 h-5"})})}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:x})]})}export{X as default};
