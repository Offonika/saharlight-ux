import{c as f,a as C,j as e}from"./index-gZWaLxZh.js";import{u as E,r as d}from"./vendor-CzhASIQC.js";import{M as R}from"./MedicalHeader-BiVwHQVw.js";import{M as o}from"./MedicalButton-CxU4I3xT.js";import{P as S,T}from"./trash-2-GlWKEENO.js";import"./switch-CGngOfw1.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=f("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=f("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=f("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);async function z(){try{const n=await fetch("/api/history");if(!n.ok)throw new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é");const a=await n.json();if(!Array.isArray(a))throw new Error("–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç");return a}catch(n){throw console.error("Failed to fetch history:",n),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é")}}async function F(n){try{const a=await fetch("/api/history",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}),l=await a.json().catch(()=>({}));if(!a.ok||l.status!=="ok")throw new Error(l.detail||"–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å");return l}catch(a){throw console.error("Failed to update history record:",a),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å")}}async function $(n){try{const a=await fetch(`/api/history/${n}`,{method:"DELETE"}),l=await a.json().catch(()=>({}));if(!a.ok||l.status!=="ok")throw new Error(l.detail||"–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å");return l}catch(a){throw console.error("Failed to delete history record:",a),new Error("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å")}}const O=()=>{const n=E(),{toast:a}=C(),[l,m]=d.useState([]),[u,p]=d.useState(""),[x,v]=d.useState("all"),[i,r]=d.useState(null);d.useEffect(()=>{let t=!1;return(async()=>{try{const s=await z();t||m(s)}catch(s){if(!t){const c=s instanceof Error?s.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";a({title:"–û—à–∏–±–∫–∞",description:c,variant:"destructive"})}}})(),()=>{t=!0}},[a]);const j=l.filter(t=>{const s=!u||t.date===u,c=x==="all"||t.type===x;return s&&c}),b=t=>{r({...t})},N=async()=>{if(i)try{await F(i),m(t=>t.map(s=>s.id===i.id?i:s)),r(null),a({title:"–ó–∞–ø–∏—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∞",description:"–ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã"})}catch(t){const s=t instanceof Error?t.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";a({title:"–û—à–∏–±–∫–∞",description:s,variant:"destructive"})}},y=async t=>{const s=[...l];m(c=>c.filter(g=>g.id!==t));try{await $(t),a({title:"–ó–∞–ø–∏—Å—å —É–¥–∞–ª–µ–Ω–∞",description:"–ó–∞–ø–∏—Å—å —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏"})}catch(c){m(s);const g=c instanceof Error?c.message:"–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞";a({title:"–û—à–∏–±–∫–∞",description:g,variant:"destructive"})}},w=t=>{switch(t){case"measurement":return"ü©∏";case"meal":return"üçΩÔ∏è";case"insulin":return"üíâ";default:return"üìù"}},h=t=>{switch(t){case"measurement":return"medical-error";case"meal":return"medical-success";case"insulin":return"medical-blue";default:return"neutral-500"}},k=t=>t<4?"text-medical-error":t>10?"text-medical-warning":t>=4&&t<=7?"text-medical-success":"text-medical-teal";return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(R,{title:"–ò—Å—Ç–æ—Ä–∏—è",showBack:!0,onBack:()=>n("/")}),e.jsxs("main",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"medical-card mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(U,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium text-foreground",children:"–§–∏–ª—å—Ç—Ä—ã"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–î–∞—Ç–∞"}),e.jsx("input",{type:"date",value:u,onChange:t=>p(t.target.value),className:"medical-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–¢–∏–ø –∑–∞–ø–∏—Å–∏"}),e.jsxs("select",{value:x,onChange:t=>v(t.target.value),className:"medical-input",children:[e.jsx("option",{value:"all",children:"–í—Å–µ –∑–∞–ø–∏—Å–∏"}),e.jsx("option",{value:"measurement",children:"–ò–∑–º–µ—Ä–µ–Ω–∏—è"}),e.jsx("option",{value:"meal",children:"–ï–¥–∞"}),e.jsx("option",{value:"insulin",children:"–ò–Ω—Å—É–ª–∏–Ω"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-6",children:[e.jsxs("div",{className:"medical-card text-center py-4",children:[e.jsx("div",{className:"text-xl font-bold text-medical-success",children:"6.8"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"–°—Ä–µ–¥–Ω–∏–π —Å–∞—Ö–∞—Ä"})]}),e.jsxs("div",{className:"medical-card text-center py-4",children:[e.jsx("div",{className:"text-xl font-bold text-medical-teal",children:"24"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"–ó–∞–ø–∏—Å–µ–π"})]}),e.jsxs("div",{className:"medical-card text-center py-4",children:[e.jsx("div",{className:"text-xl font-bold text-medical-blue",children:"85%"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"–í –Ω–æ—Ä–º–µ"})]})]}),e.jsx("div",{className:"space-y-3",children:j.map((t,s)=>e.jsx("div",{className:"medical-list-item",style:{animationDelay:`${s*50}ms`},children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 ${h(t.type)==="medical-error"?"bg-medical-error/10":h(t.type)==="medical-success"?"bg-medical-success/10":h(t.type)==="medical-blue"?"bg-medical-blue/10":"bg-neutral-500/10"}`,children:e.jsx("span",{className:"text-lg",children:w(t.type)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:new Date(t.date).toLocaleDateString("ru-RU")}),e.jsx("span",{className:"text-sm font-medium",children:t.time})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{size:"icon",onClick:()=>b(t),className:"bg-transparent hover:bg-secondary text-muted-foreground border-0 p-1","aria-label":"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",children:e.jsx(S,{className:"w-3 h-3"})}),e.jsx(o,{size:"icon",onClick:()=>y(t.id),className:"bg-transparent hover:bg-destructive/10 hover:text-destructive text-muted-foreground border-0 p-1","aria-label":"–£–¥–∞–ª–∏—Ç—å",children:e.jsx(T,{className:"w-3 h-3"})})]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-4 text-sm mb-2",children:[t.sugar&&e.jsxs("div",{children:[e.jsx("div",{className:`font-semibold ${k(t.sugar)}`,children:t.sugar}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"–º–º–æ–ª—å/–ª"})]}),t.carbs&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground",children:t.carbs}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"–≥ —É–≥–ª–µ–≤."})]}),t.breadUnits&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-foreground",children:t.breadUnits}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"–•–ï"})]}),t.insulin&&e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-medical-blue",children:t.insulin}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"–µ–¥."})]})]}),t.notes&&e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:t.notes})]})]})},t.id))}),i&&e.jsxs("div",{className:"medical-card animate-scale-in mt-6",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-4",children:"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–î–∞—Ç–∞"}),e.jsx("input",{type:"date",value:i.date,onChange:t=>r(s=>s&&{...s,date:t.target.value}),className:"medical-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–í—Ä–µ–º—è"}),e.jsx("input",{type:"time",value:i.time,onChange:t=>r(s=>s&&{...s,time:t.target.value}),className:"medical-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–°–∞—Ö–∞—Ä (–º–º–æ–ª—å/–ª)"}),e.jsx("input",{type:"number",step:"0.1",value:i.sugar??"",onChange:t=>r(s=>s&&{...s,sugar:t.target.value?Number(t.target.value):void 0}),className:"medical-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–£–≥–ª–µ–≤–æ–¥—ã (–≥)"}),e.jsx("input",{type:"number",value:i.carbs??"",onChange:t=>r(s=>s&&{...s,carbs:t.target.value?Number(t.target.value):void 0}),className:"medical-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–•–ï"}),e.jsx("input",{type:"number",value:i.breadUnits??"",onChange:t=>r(s=>s&&{...s,breadUnits:t.target.value?Number(t.target.value):void 0}),className:"medical-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–ò–Ω—Å—É–ª–∏–Ω (–µ–¥.)"}),e.jsx("input",{type:"number",value:i.insulin??"",onChange:t=>r(s=>s&&{...s,insulin:t.target.value?Number(t.target.value):void 0}),className:"medical-input"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"–ó–∞–º–µ—Ç–∫–∏"}),e.jsx("input",{type:"text",value:i.notes??"",onChange:t=>r(s=>s&&{...s,notes:t.target.value}),className:"medical-input",placeholder:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π"})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(o,{type:"button",onClick:N,className:"flex-1",size:"lg",children:"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"}),e.jsx(o,{type:"button",onClick:()=>r(null),variant:"secondary",className:"flex-1",size:"lg",children:"–û—Ç–º–µ–Ω–∞"})]})]})]}),j.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(M,{className:"w-16 h-16 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"–ó–∞–ø–∏—Å–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"}),e.jsx("p",{className:"text-muted-foreground",children:"–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—É—é –∑–∞–ø–∏—Å—å"})]}),e.jsx("div",{className:"mt-8",children:e.jsxs(o,{onClick:()=>n("/analytics"),className:"w-full flex items-center justify-center gap-2",size:"lg",children:[e.jsx(D,{className:"w-4 h-4"}),"–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∞–Ω–∞–ª–∏—Ç–∏–∫—É"]})})]})]})};export{O as default};
