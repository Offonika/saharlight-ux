import{c as p,a as f,u as j,j as e}from"./index-DQBQ-MfV.js";import{u as v,r as c}from"./vendor-CzhASIQC.js";import{M as N}from"./MedicalHeader-BDVPl0c2.js";import{M as b}from"./MedicalButton-BhCwfXK3.js";import{D as w,R as y,C as S,a as k}from"./authFetch-Dy4ehdii.js";import"./switch-D0WL0-E9.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=p("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]),T=void 0,h=new w(new S({basePath:T,fetchApi:k}));async function E(o){try{return await h.profilesGet({telegramId:o})}catch(r){if(console.error("Failed to fetch profile:",r),r instanceof y&&r.response.status===404)return null;throw r instanceof Error?new Error(`Не удалось загрузить профиль: ${r.message}`):r}}async function F(o){try{return await h.profilesPost({profile:o})}catch(r){throw console.error("Failed to save profile:",r),r instanceof Error?new Error(`Не удалось сохранить профиль: ${r.message}`):r}}const H=()=>{const o=v(),{toast:r}=f(),{user:a}=j(),[i,d]=c.useState({icr:"",correctionFactor:"",targetSugar:"",lowThreshold:"",highThreshold:""}),[u,m]=c.useState(!1);c.useEffect(()=>{if(!(a!=null&&a.id))return;let t=!0;return(async()=>{m(!0);try{const s=await E(a.id);s&&t&&d({icr:s.icr.toString(),correctionFactor:s.cf.toString(),targetSugar:s.target.toString(),lowThreshold:s.low.toString(),highThreshold:s.high.toString()})}catch(s){const g=s instanceof Error?s.message:String(s);r({title:"Ошибка",description:g,variant:"destructive"})}finally{t&&m(!1)}})(),()=>{t=!1}},[a==null?void 0:a.id,r]);const n=(t,l)=>{d(s=>({...s,[t]:l}))},x=async()=>{if(!(a!=null&&a.id)){r({title:"Ошибка",description:"Не удалось определить пользователя",variant:"destructive"});return}try{await F({telegramId:a.id,icr:Number(i.icr),cf:Number(i.correctionFactor),target:Number(i.targetSugar),low:Number(i.lowThreshold),high:Number(i.highThreshold)}),r({title:"Профиль сохранен",description:"Ваши настройки успешно обновлены"})}catch(t){const l=t instanceof Error?t.message:String(t);r({title:"Ошибка",description:l,variant:"destructive"})}};return e.jsxs("div",{className:"min-h-screen bg-background",children:[e.jsx(N,{title:"Мой профиль",showBack:!0,onBack:()=>o("/")}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:u?e.jsx("p",{className:"text-center text-muted-foreground",children:"Загрузка профиля..."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"medical-card animate-slide-up",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"ICR (Инсулино-углеводное соотношение)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:i.icr,onChange:t=>n("icr",t.target.value),className:"medical-input",placeholder:"12"}),e.jsx("span",{className:"absolute right-3 top-3 text-muted-foreground text-sm",children:"г/ед."})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Сколько граммов углеводов покрывает 1 единица инсулина"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Коэффициент коррекции (КЧ)"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:i.correctionFactor,onChange:t=>n("correctionFactor",t.target.value),className:"medical-input",placeholder:"2.5"}),e.jsx("span",{className:"absolute right-3 top-3 text-muted-foreground text-sm",children:"ммоль/л"})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"На сколько снижает сахар 1 единица инсулина"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Целевой уровень сахара"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:i.targetSugar,onChange:t=>n("targetSugar",t.target.value),className:"medical-input",placeholder:"6.0"}),e.jsx("span",{className:"absolute right-3 top-3 text-muted-foreground text-sm",children:"ммоль/л"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Нижний порог"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:i.lowThreshold,onChange:t=>n("lowThreshold",t.target.value),className:"medical-input",placeholder:"4.0"}),e.jsx("span",{className:"absolute right-3 top-3 text-muted-foreground text-xs",children:"ммоль/л"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:"Верхний порог"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"number",step:"0.1",value:i.highThreshold,onChange:t=>n("highThreshold",t.target.value),className:"medical-input",placeholder:"10.0"}),e.jsx("span",{className:"absolute right-3 top-3 text-muted-foreground text-xs",children:"ммоль/л"})]})]})]}),e.jsxs(b,{onClick:x,className:"w-full flex items-center justify-center gap-2",size:"lg",children:[e.jsx(C,{className:"w-4 h-4"}),"Сохранить настройки"]})]})}),e.jsxs("div",{className:"mt-6 medical-card",children:[e.jsx("h3",{className:"font-semibold text-foreground mb-3",children:"Справка"}),e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"ICR"})," - показывает, сколько граммов углеводов покрывает 1 единица быстрого инсулина"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"КЧ"})," - показывает, на сколько ммоль/л снижает уровень глюкозы 1 единица быстрого инсулина"]}),e.jsx("p",{children:"Эти параметры индивидуальны и должны быть определены совместно с вашим врачом"})]})]})]})})]})};export{H as default};
